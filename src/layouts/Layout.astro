---
import FloatingWhatsApp from "../components/FloatingWhatsApp.astro";
import StickyCTA from "../components/StickyCTA.astro";
import { ViewTransitions } from "astro:transitions";
import {
  SEO_CONFIG,
  getSEOTitle,
  getMetaDescription,
  getSchemaJSON,
} from "../config/seo.config";

interface Props {
  title?: string;
  description?: string;
}

const { title = getSEOTitle(), description = getMetaDescription() } =
  Astro.props;

const baseSite = Astro.site ? Astro.site.toString() : SEO_CONFIG.business.url;
const canonicalURL = new URL(Astro.url.pathname, baseSite);
const schemaJSON = getSchemaJSON();
---

<!doctype html>
<html lang="es-MX">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <ViewTransitions />

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />

    <!-- Extended Keywords for Better Ranking -->
    <meta
      name="keywords"
      content={SEO_CONFIG.keywords.primary
        .concat(SEO_CONFIG.keywords.secondary)
        .join(", ")}
    />
    <meta name="author" content="Purifreze - Purificación de Agua" />
    <meta
      name="robots"
      content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"
    />
    <link rel="canonical" href={canonicalURL} />

    <!-- Geo Tags for Local SEO -->
    <!-- Geo Tags for Local SEO -->
    <meta
      name="geo.region"
      content={SEO_CONFIG.business.contact.address.addressRegion === "Yucatán"
        ? "MX-YUC"
        : "MX"}
    />
    <meta
      name="geo.placename"
      content={`${SEO_CONFIG.business.contact.address.addressLocality}, ${SEO_CONFIG.business.contact.address.addressRegion}, ${SEO_CONFIG.business.contact.address.addressCountry}`}
    />
    <meta
      name="geo.position"
      content={`${SEO_CONFIG.business.contact.geo.latitude};${SEO_CONFIG.business.contact.geo.longitude}`}
    />
    <meta
      name="ICBM"
      content={`${SEO_CONFIG.business.contact.geo.latitude}, ${SEO_CONFIG.business.contact.geo.longitude}`}
    />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={SEO_CONFIG.business.logo} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:locale" content="es_MX" />
    <meta property="og:site_name" content={SEO_CONFIG.business.name} />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content="/assets/nombre-logo.png" />

    <!-- Additional SEO Tags -->
    <meta name="theme-color" content="#0066FF" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <!-- FontAwesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Animations CSS -->
    <link rel="stylesheet" href="/src/styles/animations.css" />

    <!-- Structured Data - Local Business -->
    <script type="application/ld+json" set:html={schemaJSON} />
  </head>
  <body>
    <slot />
    <FloatingWhatsApp />
    <StickyCTA />

    <script>
      // Scroll Animation Observer
      function initScrollAnimations() {
        const observerOptions = {
          root: null,
          rootMargin: "0px",
          threshold: 0.1,
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("visible");
            }
          });
        }, observerOptions);

        // Observe all elements with animation classes
        const animatedElements = document.querySelectorAll(
          ".fade-in, .slide-in-left, .slide-in-right, .scale-in",
        );
        animatedElements.forEach((el) => observer.observe(el));
      }

      // Initialize on page load
      document.addEventListener("DOMContentLoaded", initScrollAnimations);

      // Re-initialize after Astro page transitions
      document.addEventListener("astro:page-load", initScrollAnimations);
    </script>
  </body>
</html>
